const t=new class{constructor(){this.maxSize=10485760,this.currentSize=0,this.prefix="xubio_cache_",this.ttlMap={clientes:864e5,productos:432e5,listaPrecios:216e5,maestros:6048e5},this.calcularTamañoActual()}"calcularTamañoActual"(){this.currentSize=0;Object.keys(localStorage).forEach(t=>{if(t.startsWith(this.prefix))try{const e=localStorage.getItem(t);e&&(this.currentSize+=new Blob([e]).size)}catch(e){}})}"calcularTamañoObjeto"(t){return new Blob([JSON.stringify(t)]).size}getCachedData(t){try{const e=localStorage.getItem(`${this.prefix}${t}`);if(!e)return null;const{data:a,timestamp:r,ttl:i}=JSON.parse(e),s=Date.now();if(s-r>i)return localStorage.removeItem(`${this.prefix}${t}`),this.calcularTamañoActual(),null;Math.floor((s-r)/1e3/60);return a}catch(e){return localStorage.removeItem(`${this.prefix}${t}`),this.calcularTamañoActual(),null}}setCachedData(t,e,a=null){try{const r=a||this.getTTL(t)||36e5,i={data:e,timestamp:Date.now(),ttl:r},s=this.calcularTamañoObjeto(i);this.currentSize+s>this.maxSize&&(this.limpiarCachesExpirados(),this.currentSize+s>this.maxSize&&this.evictOldest()),localStorage.setItem(`${this.prefix}${t}`,JSON.stringify(i)),this.currentSize+=s}catch(r){r instanceof Error&&"QuotaExceededError"===r.name&&(this.limpiarCachesExpirados(),this.evictOldest())}}evictOldest(){const t=Object.keys(localStorage),e=[];t.forEach(t=>{if(t.startsWith(this.prefix))try{const a=localStorage.getItem(t);if(a){const{timestamp:r}=JSON.parse(a);e.push({key:t,timestamp:r})}}catch(a){}}),e.sort((t,e)=>t.timestamp-e.timestamp);for(const a of e){if(this.currentSize<.8*this.maxSize)break;localStorage.removeItem(a.key)}this.calcularTamañoActual()}invalidarCache(t){const e=`${this.prefix}${t}`;localStorage.getItem(e)&&(localStorage.removeItem(e),this.calcularTamañoActual())}limpiarCachesExpirados(){const t=Object.keys(localStorage);t.forEach(t=>{if(t.startsWith(this.prefix))try{const e=localStorage.getItem(t);if(e){const{timestamp:a,ttl:r}=JSON.parse(e);Date.now()-a>r&&localStorage.removeItem(t)}}catch(e){localStorage.removeItem(t)}}),this.calcularTamañoActual()}getTTL(t){return this.ttlMap[t]||36e5}limpiarTodosLosCaches(){const t=Object.keys(localStorage);let e=0;return t.forEach(t=>{t.startsWith(this.prefix)&&(localStorage.removeItem(t),e++)}),this.currentSize=0,e}getStats(){return{currentSize:this.currentSize,maxSize:this.maxSize,usagePercent:Math.round(this.currentSize/this.maxSize*100),entries:Object.keys(localStorage).filter(t=>t.startsWith(this.prefix)).length}}};function e(t){return t?t.replace(/\n/g,"<br>"):""}function a(t){return t&&0!==t?parseFloat(String(t)).toFixed(2):"0.00"}function r(t){if(!t)return"";const e=t.toString().replace(/\D/g,"");return 11===e.length?`${e.substring(0,2)}-${e.substring(2,10)}-${e.substring(10,11)}`:e.length>0&&e.length<11?e:(t.match(/^\d{2}-\d{8}-\d{1}$/),t)}function i(t,e=300){let a=null;return function(...r){null!==a&&clearTimeout(a),a=setTimeout(()=>{a=null,t(...r)},e)}}export{r as a,e as b,t as c,i as d,a as f};
